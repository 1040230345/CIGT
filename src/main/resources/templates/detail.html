<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CIGT详情</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="/static/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="/static/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700">
    <!-- owl carousel-->
    <link rel="stylesheet" href="/static/vendor/owl.carousel/assets/owl.carousel.css">
    <link rel="stylesheet" href="/static/vendor/owl.carousel/assets/owl.theme.default.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="/static/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="/static/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="/static/favicon.png">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
		<!-- 头部 -->
		<link rel="import" href="/static/header.html" id="header">
		<!-- 底部 -->
		<link rel="import" href="/static/footer.html" id="footer">
 
  </head>
  <body>
	  
	  <script>
	  		document.write(header.import.body.innerHTML);
	  </script>
    
	<div id="CIGTdetail">
	
    <div id="all">
      <div id="content">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <!-- breadcrumb-->
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="index">首页</a></li>
                  <li aria-current="page" class="breadcrumb-item active">{{good.type.category}} ({{good.data.name}})</li>
                </ol>
              </nav>
            </div>
            <div class="col-lg-3 order-2 order-lg-1">
              <div class="banner" style="box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);margin-bottom: 20px">
                  <a href="#"><img src="/static/img/banner.jpg" alt="sales 2014" class="img-fluid"></a>
              </div>
                <div class="banner" style="box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);margin-bottom: 20px">
                    <a href="#"><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1580988620196&di=ea1b621832ac8dfc4d4c38c4af96ee65&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2Fae19660d31710b150109251e3f1d3ed34fb7bf1f3f2ec-66jOBv_fw658" alt="sales 2014" class="img-fluid"></a>
                </div>
                <div class="banner" style="box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);margin-bottom: 20px">
                    <a href="#"><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1580988869385&di=33e6d6723274c15ba8e1c52bf12007b2&imgtype=0&src=http%3A%2F%2Fhbimg.b0.upaiyun.com%2F3187db4c4a3c43c928e0dd7d6a5ba6d64430ef3bb14b8-pb0hSo_fw658" alt="sales 2014" class="img-fluid"></a>
                </div>
            </div>
            <div class="col-lg-9 order-1 order-lg-2">
              <div id="productMain" class="row">
                <div class="col-md-6">
                  <div data-slider-id="1" class="owl-carousel shop-detail-carousel" style="height:398px">
                    <div class="item"> <img :src="good.data.images" alt="" class="img-fluid"></div>
                    <div class="item"> <img :src="good.data.banner_image1" alt="" class="img-fluid"></div>
                    <div class="item"> <img :src="good.data.banner_image2" alt="" class="img-fluid"></div>
					<div class="item"> <img :src="good.data.banner_image3" alt="" class="img-fluid"></div>
                  </div>
				  <div class="ribbon new">
				    <div class="theribbon">出售</div>
				    <div class="ribbon-background"></div>
				  </div>
                  <div class="ribbon sale">
                    <div class="theribbon">新品</div>
                    <div class="ribbon-background"></div>
                  </div>
                  <!-- /.ribbon-->

                  <!-- /.ribbon-->
                </div>
                <div class="col-md-6">
                  <div class="box" style="height:278px;">
                      <div style="height:85px;display: flex;align-items: center;justify-content: center;">
                          <h1 class="text-center" style="font-size: 1.5rem;">{{good.data.name}}</h1>
                          <span v-if="good.data.status == 1" style="color:#cccccc"> 已下架</span>
                      </div>

                    <p class="goToDescription" style="margin-top:15px"><a href="#details" class="scroll-to">滚动到产品详情、评论</a></p>
                    <p class="price" style="margin-top:0px">${{good.data.price}}</p>
                    <p class="text-center buttons">
                        <a href="javascript:;"  @click="BuyShow"
                           class="btn" style="background:#17A2b8;color:#f0f0f0;"><i class="fa fa-shopping-cart"></i> 立即购买</a>
                        <a href="javascript:;" class="btn btn-primary" @click="ShowAddBasket(good.data)">
                            <i class="fa fa-shopping-cart"></i>加入购物车</a>
                      </p>
                  </div>
                  <div data-slider-id="1" class="owl-thumbs">
                    <button class="owl-thumb-item"><img :src="good.data.images" alt="" class="img-fluid"></button>
                    <button class="owl-thumb-item"><img :src="good.data.banner_image1" alt="" class="img-fluid"></button>
                     <button class="owl-thumb-item"><img :src="good.data.banner_image2" alt="" class="img-fluid"></button>
					  <button class="owl-thumb-item"><img :src="good.data.banner_image3" alt="" class="img-fluid"></button>
                  </div>
                </div>
              </div>
<!--                加入购物车弹窗-->
                <el-dialog :title="'添加至购物车-( '+addbasket.name+' )'" :visible.sync="cartshow">
                    <el-form  >
                        <el-form-item label="数量" required>
                            <el-input-number v-model="num"  :min="1"  ></el-input-number>
                        </el-form-item>
                        <el-form-item label="地址"  required>
                            <el-input v-model="address"></el-input>
                        </el-form-item>
                    </el-form>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="cartshow = false">取 消</el-button>
                        <el-button type="primary" style="background: #4fbfa8" @click="AddBasket">确 定</el-button>
                    </div>
                </el-dialog>
<!--                立即购买弹窗-->
                <el-dialog :title="'立即购买-( '+good.data.name+' )'" :visible.sync="centerDialogVisible">
                    <el-form  >
                        <el-form-item label="数量" required>
                            <el-input-number v-model="num"  :min="1"  ></el-input-number>
                        </el-form-item>
                        <el-form-item label="地址"  required>
                            <el-input v-model="address"></el-input>
                        </el-form-item>
                    </el-form>
                    <div slot="footer" class="dialog-footer">
                        <el-button @click="centerDialogVisible = false">取 消</el-button>
                        <el-button type="primary" style="background: #4fbfa8" @click="NowBuy">确 定</el-button>
                    </div>
                </el-dialog>
			  <!-- 数量详情 -->
              <div id="details" class="box">
                <p></p>
                <h4 style="font-weight:bold">数量 &amp; 详情</h4>
				<ul style="list-style: none;">
				  <li>库存：{{good.data.num}} 件</li>
				  <li><p>介绍：{{good.data.depict}}</p></li>
				</ul>
              
                
                <hr>
<!--                <div class="social">-->
<!--                  <h4>分享给好友</h4>-->
<!--                  <p><a href="#" class="external facebook"><i class="fa fa-facebook"></i></a><a href="#" class="external gplus"><i class="fa fa-google-plus"></i></a><a href="#" class="external twitter"><i class="fa fa-twitter"></i></a><a href="#" class="email"><i class="fa fa-envelope"></i></a></p>-->
<!--                </div>-->
              </div>
			  <!-- 评论 -->
			   <div id="details" class="box">
				   <div id="comments">
				     <h4 style="display: inline;position: center;font-weight:bold;"> 评 论 {{comment.length}} 条</h4>
                       <input type="text" placeholder="请输入评论" v-model="mycomment" style="margin-left:10px;border-radius: 5px;outline: none;padding: 2px; "/>
                       <a href="javascript:;" style="display: inline;margin-left:10px;"
                          class="btn btn-primary" @click="SetMycomment">发表评论</a>
                       <hr>
				     <div class="row comment" style="margin-top:20px;"
					 v-for="(item,index) in comment" :key="index">
						 <!-- 头像 -->
				       <div class="col-md-3 col-lg-2 text-center text-md-center">
				         <p><img :src="item.image" alt="" class="img-fluid rounded-circle"
						 style="height:100px;"></p>
				       </div>
				       <div class="col-md-9 col-lg-10">
						   <!-- 姓名，性别，账号 -->
				         <h5>{{item.real_name}}
						 ( {{item.name}} )
                             <i v-if="item.sex=='男'" class="el-icon-male" style="color:blue"></i>
                             <i v-if="item.sex=='女'" class="el-icon-female" style="color:deeppink"></i> </h5>
							<!-- 回复时间 -->
				         <p class="posted"><i class="fa fa-clock-o"></i> {{item.create_time}}</p>
							<!-- 评价内容 -->
				         <p>{{item.content}}。</p>
						 <!-- ------------------- -->
						<el-collapse v-model="activeNames">
						  <el-collapse-item :title="'回复 '+item.commentExts.length+'条 点击查看'" :name="item.id">
						    <div v-for="(it,ix) in item.commentExts" :key="ix" style="display:flex;align-items: center;padding:5px">
								    <el-avatar size="large" :src="it.image" style="width:40px;height:40px;"></el-avatar>
									<span style="margin-left:10px;width:70%;"> {{it.real_name}} : {{it.content}}</span>
									<span style="color:grey">{{it.create_time}}</span>
									  
								
							</div>
						  </el-collapse-item>
						</el-collapse>
						 <!-- ----------------------- -->
						<el-input  size="small"  placeholder="请输入回复内容" v-model="content"
						style="width:200px;margin-top:10px;">
						  </el-input><a href="javascript:;" @click="SetGoodComment(item)"><i class="fa fa-reply"></i> 回复</a>
				       </div>
				     </div>
				     <!-- /.comment-->
				   </div>
				</div>   
			  
              <div class="row same-height-row">
                <div class="col-md-3 col-sm-6">
                  <div class="box same-height">
                    <h3>你 也 可 能 喜 欢 这 些 产 品</h3>
                  </div>
                </div>
                <div class="col-md-3 col-sm-6">
                  <div class="product same-height">
                    <div class="flip-container">
                      <div class="flipper">
                        <div class="front"><a href="detail"><img src="/static/img/product2.jpg" alt="" class="img-fluid"></a></div>
                        <div class="back"><a href="detail"><img src="/static/img/product2_2.jpg" alt="" class="img-fluid"></a></div>
                      </div>
                    </div><a href="detail" class="invisible"><img src="/static/img/product2.jpg" alt="" class="img-fluid"></a>
                    <div class="text">
                      <h3>生 锈 的 白 色 带 花 短 袖</h3>
                      <p class="price">$143</p>
                    </div>
                  </div>
                  <!-- /.product-->
                </div>
                <div class="col-md-3 col-sm-6">
                  <div class="product same-height">
                    <div class="flip-container">
                      <div class="flipper">
                        <div class="front"><a href="detail"><img src="/static/img/product1.jpg" alt="" class="img-fluid"></a></div>
                        <div class="back"><a href="detail"><img src="/static/img/product1_2.jpg" alt="" class="img-fluid"></a></div>
                      </div>
                    </div><a href="detail" class="invisible"><img src="/static/img/product1.jpg" alt="" class="img-fluid"></a>
                    <div class="text">
                      <h3>破 旧 不 堪 的 黄 色 外 套</h3>
                      <p class="price">$143</p>
                    </div>
                  </div>
                  <!-- /.product-->
                </div>
                <div class="col-md-3 col-sm-6">
                  <div class="product same-height">
                    <div class="flip-container">
                      <div class="flipper">
                        <div class="front"><a href="detail"><img src="/static/img/product3.jpg" alt="" class="img-fluid"></a></div>
                        <div class="back"><a href="detail"><img src="/static/img/product3_2.jpg" alt="" class="img-fluid"></a></div>
                      </div>
                    </div><a href="detail.html" class="invisible"><img src="/static/img/product3.jpg" alt="" class="img-fluid"></a>
                    <div class="text">
                      <h3>变 异 成 人 的 黑 兔 子</h3>
                      <p class="price">$143</p>
                    </div>
                  </div>
                  <!-- /.product-->
                </div>
              </div>
            </div>
            <!-- /.col-md-9-->
          </div>
        </div>
      </div>
    </div>
	
	</div>
    <!--
    *** FOOTER ***
    _________________________________________________________
    -->
 <script>
 		document.write(footer.import.body.innerHTML);
 </script>
    <!-- *** COPYRIGHT END ***-->
    <!-- JavaScript files-->
    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/static/vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="/static/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="/static/vendor/owl.carousel2.thumbs/owl.carousel2.thumbs.js"></script>
    <script src="/static/js/front.js"></script>
  </body>
  
  <script type="text/javascript">
      let userinfo=JSON.parse(sessionStorage.getItem('userinfo'))
	var CIGTdetail=new Vue({
		el:'#CIGTdetail',
		data(){
			return {
                cartshow:false,    //加入购物车弹窗显示参数
                addbasket:{},       //加入购物车商品参数
			    num:1,
                address:null,
                centerDialogVisible:false,

			    mycomment:null,     //我发表的评论
				typelist:null,	//商品分类列表
				content:'',		//评论内容
				
				activeNames: ['0'],
				comment:[{
					commentExts:[{}]
				}],
				good:{
					type:'类型',
					data:{
							image:'img/detailbig2.jpg',
							name:'名称',
					}
				}
			}
		},
		mounted() {

			//尝试获取session里的商品信息
			let good=sessionStorage.getItem('good')
			if(good!=null){
				good=JSON.parse(good)
				this.good=good
				console.log(good)
			}else{
				window.location.href='category.html'
				return
			}
			//获取session里的分类
			this.typelist=JSON.parse(sessionStorage.getItem('typelist'))
			//获取评论
			this.GetGoodComment()
		},
		methods:{
		    //加入购物车
            ShowAddBasket(item){
                userinfo = JSON.parse(sessionStorage.getItem('userinfo'));
                if(userinfo==null){
                    this.$notify({title: '未登录，请先登录',type: 'warning'});
                    return
                }else {
                    this.address = userinfo.address;
                }
                this.cartshow=true
                this.addbasket=item
            },
            //加入购物车
            AddBasket(){
                if(this.address==null||this.address==''){this.$notify({title: '地址不能为空',type: 'warning'});return}
                MyAjax('/api/insertShoppingInfo','POST',{
                    goods_id:this.addbasket.id,
                    number:this.num,
                    user_address:this.address,
                    userId:userinfo.id
                }).then(res=>{
                    console.log(res)
                    if(res.code==0){
                        this.$notify({
                            title: '加入购物车成功',
                            type: 'success'
                        });
                        this.cartshow=false
                    }else if(res.code == 500) {
                        this.$notify.error({
                            title: '加入失败，超过商品库存',
                        });
                    }else{
                        this.$notify.error({
                            title: '加入购物车失败',
                        });
                    }
                })
            },
            BuyShow(){
                userinfo=JSON.parse(sessionStorage.getItem('userinfo'))
                if(userinfo==null){
                    this.$notify({title: '未登录，请先登录',type: 'warning'});
                    return
                }else {
                    this.address = userinfo.address;
                }
                this.centerDialogVisible=true;
            },
		    //立即购买
            NowBuy(){
              console.log(this.num)
                console.log(this.address)
                console.log(this.good.data.id)
                console.log(userinfo.id)
                MyAjax('/api/successPayOneInfo','POST',{
                    user_id:userinfo.id,
                    goods_id:this.good.data.id,
                    number:this.num,
                    user_address:this.address
                }).then(res=>{
                    console.log(res);
                    if(res.code==0){
                        this.$notify({
                            title: '购买成功',
                            type: 'success'
                        });
                        setTimeout(function(){
                            window.location.href = 'userorder';
                        },1500);
                        this.centerDialogVisible=false
                    }else if(res.code == 500) {
                        this.$notify.error({
                            title: '购买的数量超过商品的库存',
                        });
                    }else {
                        this.$notify.error({
                            title: '购买失败',
                        });
                    }
                })
            },
		    //发表我的评论
            SetMycomment(){
                let userinfo=JSON.parse(sessionStorage.getItem('userinfo'))
                if(userinfo==null){
                    this.$notify({title: '未登录，请先登录',type: 'warning'});
                    return
                }
                MyAjax('/api/sendCommentInfo','POST',{
                    goods_id:this.good.data.id,
                    userId:userinfo.id,
                    content:this.mycomment
                }).then(res=>{
                    if(res.code==0){
                        this.$notify({
                            title: '发表成功',
                            type: 'success'
                        });
                        this.GetGoodComment()
                    }else{
                        this.$notify.error({
                            title: '发表失败',
                        });
                    }
                })
            },
			//提交评论
			SetGoodComment(item){
				console.log(item)
				let userinfo=JSON.parse(sessionStorage.getItem('userinfo'))
				if(userinfo==null){
					this.$notify({title: '未登录，请先登录',type: 'warning'});
					return 
				}
				if(this.content==''){ this.$message('评论内容不能为空');return}
				MyAjax('/api/sendCommentInfo','POST',{
					content:this.content,
					goods_id:this.good.data.id,
					pid:item.id,
					reply_id:item.user_id,
                    userId:userinfo.id,
				}).then(res=>{
					if(res.code==0){
						 this.$notify({
						          title: '评论成功',
						          type: 'success'
						        });
						this.GetGoodComment()
					}else{
						 this.$notify.error({
						          title: '评论失败',
						        });
					}
				})
			},
			//获取商品评论
			GetGoodComment(){
				console.log(this.good.data.id)
				MyAjax('/api/getCommentInfo','POST',{
					goods_id:this.good.data.id
				}).then(res=>{
					if(res.code==0){
					    console.log(res.data)
						this.comment=res.data
					}
					console.log(this.comment)
				})
			}
		}
	})
  </script>
  
</html>